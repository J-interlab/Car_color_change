var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){var i=this._clampDistance(t);Math.abs(i-this._targetDistance)>1e-5&&this.app.fire("taggingEvent","zoomChanged"),this._targetDistance=i}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));this.distance=1.5*e/Math.sin(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this._yaw=-58.8,this._pitch=-24,this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this.app.graphicsDevice.height,this.app.graphicsDevice.width;this._distance=7.4,this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._distance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._distance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._pitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._pitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var o=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,o),Math.atan2(o.y,-o.z)*pc.math.RAD_TO_DEG};var OrbitCameraInputMouse=pc.createScript("orbitCameraInputMouse");OrbitCameraInputMouse.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),OrbitCameraInputMouse.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),OrbitCameraInputMouse.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(i){t.onMouseOut(i)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},OrbitCameraInputMouse.fromWorldPoint=new pc.Vec3,OrbitCameraInputMouse.toWorldPoint=new pc.Vec3,OrbitCameraInputMouse.worldDiff=new pc.Vec3,OrbitCameraInputMouse.prototype.pan=function(t){var i=OrbitCameraInputMouse.fromWorldPoint,e=OrbitCameraInputMouse.toWorldPoint,a=OrbitCameraInputMouse.worldDiff,o=this.entity.camera,n=this.orbitCamera.distance;o.screenToWorld(t.x,t.y,n,i),o.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),a.sub2(e,i),this.orbitCamera.pivotPoint.add(a)},OrbitCameraInputMouse.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:null!=window.isNight&&(window.isNight=!window.isNight,this.app.fire("setDay",window.isNight)),this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},OrbitCameraInputMouse.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},OrbitCameraInputMouse.prototype.onMouseMove=function(t){this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown,this.lastPoint.set(t.x,t.y)},OrbitCameraInputMouse.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},OrbitCameraInputMouse.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var OrbitCameraInputTouch=pc.createScript("orbitCameraInputTouch");OrbitCameraInputTouch.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),OrbitCameraInputTouch.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),OrbitCameraInputTouch.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},OrbitCameraInputTouch.prototype.getPinchDistance=function(t,i){var e=t.x-i.x,a=t.y-i.y;return Math.sqrt(e*e+a*a)},OrbitCameraInputTouch.prototype.calcMidPoint=function(t,i,e){e.set(i.x-t.x,i.y-t.y),e.scale(.5),e.x+=t.x,e.y+=t.y},OrbitCameraInputTouch.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1===i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2===i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},OrbitCameraInputTouch.fromWorldPoint=new pc.Vec3,OrbitCameraInputTouch.toWorldPoint=new pc.Vec3,OrbitCameraInputTouch.worldDiff=new pc.Vec3,OrbitCameraInputTouch.prototype.pan=function(t){var i=OrbitCameraInputTouch.fromWorldPoint,e=OrbitCameraInputTouch.toWorldPoint,a=OrbitCameraInputTouch.worldDiff,o=this.entity.camera,n=this.orbitCamera.distance;o.screenToWorld(t.x,t.y,n,i),o.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,n,e),a.sub2(e,i),this.orbitCamera.pivotPoint.add(a)},OrbitCameraInputTouch.pinchMidPoint=new pc.Vec2,OrbitCameraInputTouch.prototype.onTouchMove=function(t){OrbitCameraInputTouch.pinchMidPoint;var i=t.touches;if(1===i.length){var e=i[0];this.orbitCamera.pitch-=(e.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(e.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(e.x,e.y)}else if(2===i.length){var a=this.getPinchDistance(i[0],i[1]),o=a-this.lastPinchDistance;this.lastPinchDistance=a,this.orbitCamera.distance-=o*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance)}};var CameraController=pc.createScript("cameraController");CameraController.prototype.initialize=function(){this.app.on("cameraRotate",this.onCameraRotateEvent,this),this.app.on("cameraRotate360",this.onCameraRotate360Event,this),this.app.on("cameraRotateToSpot",this.onCameraRotateToSpotEvent,this),this.app.on("cameraSet",this.onCameraSet,this),this.orbitCamera=this.entity.script.orbitCamera,this.isRotate=!1,this.rotate=0},CameraController.prototype.onCameraRotateEvent=function(t){this.isRotate=t},CameraController.prototype.onCameraRotate360Event=function(){this.rotate=360},CameraController.prototype.onCameraSet=function(t){3==t.length&&this.orbitCamera.reset(t[0],t[1],t[2])},CameraController.prototype.onCameraRotateToSpotEvent=function(t){var i=this.app.root.findByName("spot buttons").findByName(t);if(null!=i){var e=this.orbitCamera._modelsAabb.center,a=i.getPosition(),o=new pc.Vec3;o.copy(a),o.sub(e),o.normalize();var n=180*Math.atan2(o.x,o.z)/Math.PI,s=180*Math.acos(o.y)/Math.PI-90;this.orbitCamera.yaw=n,this.orbitCamera.pitch=s,this.orbitCamera.distance=7.4}},CameraController.prototype.update=function(t){if(this.rotate>0){var i=200*t;this.orbitCamera.yaw+=i,this.rotate-=i}else this.isRotate&&(this.orbitCamera.yaw+=2*t)};var Patch=pc.createScript("patch");Patch.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"materials",description:"materials list for clearcoat patching"}),Patch.prototype.initialize=function(){this.materials.forEach((t=>{t.resources[0].clearCoat=.14,t.resources[0].clearCoatBumpiness=.95,t.resources[0].update()}))},Patch.prototype.update=function(t){};var Reflection=pc.createScript("reflection");Reflection.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"materials",description:"material list for reflection patching"}),Reflection.prototype.initialize=function(){if(window.location.href.startsWith("https://launch.playcanvas.com/"));else{this.materials.forEach((e=>{e.resources[0].chunks.reflectionSpherePS="\n#ifndef VIEWMATRIX\n    #define VIEWMATRIX\n    uniform mat4 matrix_view;\n#endif\n\n#ifndef PI\n    #define PI 3.1415926538\n#endif\n\nuniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\n\nvec3 calcReflection(vec3 tReflDirW, float tGlossiness) {\n    float x = atan(tReflDirW.z, tReflDirW.x);\n    x = (x / PI + 1.0) / 2.0 + 0.75;\n    if(x > 1.0) {\n        x -= 1.0;\n    }\n    float y = acos(tReflDirW.y) / PI ;\n\n    // float epsilon = 1e-2;\n    vec3 colorC = texture2D(texture_sphereMap, vec2(x, y)).rgb;\n    \n    return colorC;\n\n}\n\nvoid addReflection() {   \n    dReflection += vec4(calcReflection(dReflDirW, dGlossiness), material_reflectivity);\n}"}))}},Reflection.prototype.update=function(e){},Reflection.prototype.swap=function(e){};var FlareFilter=pc.createScript("flareFilter");FlareFilter.attributes.add("vs",{type:"asset",assetType:"shader"}),FlareFilter.attributes.add("fs",{type:"asset",assetType:"shader"}),FlareFilter.prototype.initialize=function(){var e=pc.app.graphicsDevice,t="precision "+e.precision+" float;\n"+this.fs.resource,a={attributes:{aPosition:pc.SEMANTIC_POSITION,aNormal:pc.SEMANTIC_NORMAL,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:this.vs.resource,fshader:t};this.materials=[];let s=this.entity.model.meshInstances.length;for(let t=0;t<s;t++){let s=new pc.Material,r=new pc.Shader(e,a);s.blendType=pc.BLEND_ADDITIVE,s.shader=r,s.depthWrite=!1,s.depthTest=!1,s.update();let i=this.entity.model.meshInstances[t].material.emissiveMap;s.setParameter("uDiffuseMap",i);let l=this.entity.model.meshInstances[t].material.emissive;s.setParameter("uEmissive",[l.r,l.g,l.b]),this.materials.push(s),this.entity.model.meshInstances[t].material=s}},FlareFilter.prototype.update=function(e){var t=pc.app.root.findByName("Camera").forward;for(let e of this.materials)e.setParameter("uViewVec",[-t.x,-t.y,-t.z])};var LookCamera=pc.createScript("lookCamera");LookCamera.attributes.add("mouseLookSensitivity",{type:"number",default:0,title:"Mouse Look Sensitivity"}),LookCamera.attributes.add("touchLookSensitivity",{type:"number",default:0,title:"Touch Look Sensitivity"}),LookCamera.attributes.add("snappinessFactor",{type:"number",default:.1,title:"Snappiness Factor",description:"Lower is faster"}),LookCamera.prototype.initialize=function(){this._tempQuat1=new pc.Quat,this._tempQuat2=new pc.Quat,this._tempVec3_1=new pc.Vec3;var t=this.entity.getLocalRotation();this.ey=this.getYaw(t)*pc.math.RAD_TO_DEG,this.ex=this.getPitch(t,this.ey)*pc.math.RAD_TO_DEG,this.ex=-8,this.ey=-93.4,this.alpha=0,this.beta=0,this.gamma=0,this.startAngle=0,this.targetEx=this.ex,this.targetEy=this.ey,this.moved=!1,this.app.mouse.disableContextMenu(),this.lastTouchPosition=new pc.Vec2,this.addEventCallbacks(),this.entity.camera.fov=this.isPortrait()?90:60,this.so=0,this._gyroscope=!1},LookCamera.prototype.isPortrait=function(){var t=this.app.graphicsDevice;return t.width<t.height},LookCamera.prototype.addEventCallbacks=function(){if(this.app.mouse&&(this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)),this.app.touch){this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this);var t=this;window.parent.addEventListener("orientationchange",(function(){t.so=window.orientation||0}),!1)}},LookCamera.prototype.getQuaternionFromOrientation=function(t,e,o){var a=pc.math.DEG_TO_RAD*e,i=pc.math.DEG_TO_RAD*t+Math.PI/2,s=pc.math.DEG_TO_RAD*-o,r=Math.cos(a/2),n=Math.cos(i/2),h=Math.cos(s/2),p=Math.sin(a/2),c=Math.sin(i/2),m=Math.sin(s/2),u=new pc.Quat(p*n*h+r*c*m,r*c*h-p*n*m,r*n*m-p*c*h,r*n*h+p*c*m),l=(new pc.Quat).setFromEulerAngles(0,this.startAngle,0);l.mul(u);var y=new pc.Quat(-Math.sqrt(.5),0,0,Math.sqrt(.5));l.mul(y);var E=new pc.Quat;return E.setFromAxisAngle(pc.Vec3.FORWARD,this.so),l.mul(E),l},LookCamera.prototype.update=function(t){if(this._gyroscope){var e=this.getQuaternionFromOrientation(this.alpha,this.beta,this.gamma);this.entity.setLocalRotation(e)}else{var o=1;this.snappinessFactor>0&&(o=t/this.snappinessFactor),this.ex=pc.math.lerp(this.ex,this.targetEx,o),this.ey=pc.math.lerp(this.ey,this.targetEy,o),this.entity.setLocalEulerAngles(this.ex,this.ey,0)}var a=this.entity.camera.fov;a=this.isPortrait()?pc.math.clamp(a,72,90):pc.math.clamp(a,42,60),this.entity.camera.fov=a},LookCamera.prototype.moveCamera=function(t,e,o){this.moved?(this.targetEx+=e*o,this.targetEx=pc.math.clamp(this.targetEx,-90,90),this.targetEy+=t*o):this.moved=!0},LookCamera.prototype.onMouseMove=function(t){this.app.mouse.isPressed(pc.MOUSEBUTTON_LEFT)&&this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity)},LookCamera.prototype.onMouseWheel=function(t){if(null==this.entity.camera)return;let e=this.entity.camera.fov+2*t.wheelDelta;this.entity.camera.fov=e},LookCamera.prototype.onTouchStart=function(t){var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y),this.lastDistance=null},LookCamera.prototype.onTouchEnd=function(t){if(1===t.touches.length){var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y)}},LookCamera.prototype.getPinchDistance=function(t,e){var o=t.x-e.x,a=t.y-e.y;return Math.sqrt(o*o+a*a)},LookCamera.prototype.onTouchMove=function(t){var e=t.touches;if(1===e.length){var o=e[0];this.moveCamera(o.x-this.lastTouchPosition.x,o.y-this.lastTouchPosition.y,this.touchLookSensitivity),this.lastTouchPosition.set(o.x,o.y)}else if(2===e.length){var a=this.getPinchDistance(e[0],e[1]);null!=this.lastDistance&&this.onMouseWheel({wheelDelta:-.07*(a-this.lastDistance)}),this.lastDistance=a}},LookCamera.prototype.getYaw=function(){var t=this.entity.forward.clone();return Math.atan2(-t.x,-t.z)},LookCamera.prototype.getPitch=function(t,e){var o=this._tempQuat1,a=this._tempQuat2;a.setFromEulerAngles(0,-e,0),o.mul2(a,t);var i=this._tempVec3_1;return o.transformVector(pc.Vec3.FORWARD,i),Math.atan2(i.y,-i.z)},LookCamera.prototype.getRotationFromOrientation=function(t,e,o){var a=e*pc.math.DEG_TO_RAD,i=o*pc.math.DEG_TO_RAD,s=t*pc.math.DEG_TO_RAD,r=(Math.cos(a),Math.cos(i)),n=Math.cos(s),h=Math.sin(a),p=Math.sin(i),c=Math.sin(s),m=r*c*h+n*p,u=c*p-n*r*h;return Math.sqrt(m*m+u*u)>1e-5?Math.atan2(m,u)*pc.math.RAD_TO_DEG:0},Object.defineProperty(LookCamera.prototype,"pitch",{get:function(){return this.targetEx},set:function(t){this.ex=t,this.targetEx=t}}),Object.defineProperty(LookCamera.prototype,"yaw",{get:function(){return this.targetEy},set:function(t){this.ey=t,this.targetEy=t}}),Object.defineProperty(LookCamera.prototype,"orientation",{set:function(t){this.alpha=t.alpha,this.beta=t.beta,this.gamma=t.gamma}}),Object.defineProperty(LookCamera.prototype,"gyroscope",{set:function(t){this._gyroscope=t,t&&(this.startAngle=this.getRotationFromOrientation(this.alpha,this.beta,this.gamma))}});var InteriorCameraController=pc.createScript("interiorCameraController");InteriorCameraController.prototype.initialize=function(){this.app.on("cameraRotateToSpot",this.onCameraRotateToSpotEvent,this),this.lookCamera=this.entity.script.lookCamera},InteriorCameraController.prototype.onCameraRotateToSpotEvent=function(t){var e=this.app.root.findByName("spot buttons").findByName(t);if(null!=e){var o=pc.Vec3.ZERO,a=e.getPosition(),i=new pc.Vec3;i.copy(a).scale(-1),i.sub(o),i.normalize();var s=Math.atan2(i.x,i.z)*pc.math.RAD_TO_DEG,r=Math.acos(i.y)*pc.math.RAD_TO_DEG-90;this.lookCamera.yaw=s,this.lookCamera.pitch=r}},InteriorCameraController.prototype.update=function(t){};var SceneController=pc.createScript("sceneController"),scenes={1211819:"exterior15",1211827:"interior15_0",1211830:"start",1212598:"exterior4",1945018:"interior16_0",1213176:"interior12_0",1213182:"interior8_0",1213194:"interior11_0",1213214:"interior0_0",1213233:"interior4_0",1213259:"exterior12",1213263:"exterior8",1213272:"exterior11",1213280:"exterior0",1944136:"exterior16",1803252:"exterior13",1803253:"interior13_0",1839566:"exterior14",1839567:"interior14_0",1930079:"exterior17",1329429:"exterior10",1213173:"interior10_0"};function getSceneID(e){for(var t in scenes)if(scenes[t]===e)return t;return 0}SceneController.prototype.initialize=function(){this.app.on("changeScene",this.onChangeSceneEvent,this),this._loadingScene=!1,this.sceneRootEntity=this.app.root.findByName("Scene Root")},SceneController.prototype.onChangeSceneEvent=function(e){if(this.app.fire("setDay",!0),0!==getSceneID(e)&&!this._loadingScene){this._loadingScene=!0,this.sceneRootEntity.children.length>0&&this.sceneRootEntity.children[0].destroy();var t=this,r=this.app.scenes.find(e);this.app.scenes.loadSceneHierarchy(r.url,(function(e,r){e?console.error(e):(r.reparent(t.sceneRootEntity),t._loadingScene=!1,t.app.fire("sceneLoaded"))})),["exterior10","exterior11","exterior16"].indexOf(e)>=0&&this.app.scenes.loadSceneSettings(r.url)}},SceneController.prototype.update=function(e){};var ColorController=pc.createScript("colorController");ColorController.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"materials",description:"materials list for clearcoat patching"}),ColorController.prototype.initialize=function(){this.app.on("changeColor",this.onChangeColorEvent,this)},ColorController.prototype.setColor=function(e,s){e.resources[0].diffuse.set(s.diffuse.r,s.diffuse.g,s.diffuse.b,s.diffuse.a||1),e.resources[0].emissive.set(s.emissive.r,s.emissive.g,s.emissive.b,s.emissive.a||1),e.resources[0].metalness=s.metalness||.98,e.resources[0].shininess=s.glossiness?100*s.glossiness:35,e.resources[0].reflectivity=1,e.resources[0].reflectivity=s.reflectivity||.5,e.resources[0].clearCoat=s.clearcoat||.15,e.resources[0].update()},ColorController.prototype.onChangeColorEvent=function(e,s){null!=e&&(this.materials.length>=1&&this.setColor(this.materials[0],e),2===this.materials.length&&this.setColor(this.materials[1],s||e))},ColorController.prototype.update=function(e){};var DaynightController=pc.createScript("daynightController");DaynightController.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"materials",description:"materials list for clearcoat patching"}),DaynightController.attributes.add("dayIntensities",{type:"number",array:!0,title:"day intensities",description:"intensities for day"}),DaynightController.attributes.add("nightIntensities",{type:"number",array:!0,title:"night intensities",description:"intensities for night"}),DaynightController.attributes.add("dayTextures",{type:"asset",assetType:"texture",array:!0,title:"day textures",description:"textures for day"}),DaynightController.attributes.add("nightTextures",{type:"asset",assetType:"texture",array:!0,title:"night textures",description:"textures for night"}),DaynightController.attributes.add("lightOnEntity",{type:"entity",title:"light on",description:"light on entity"}),DaynightController.attributes.add("lightOffEntity",{type:"entity",title:"light off",description:"light off entity"}),DaynightController.attributes.add("flareEntity",{type:"entity",title:"flare entity",description:"flare entity"}),DaynightController.prototype.initialize=function(){this.app.on("setDay",this.onSetDayEvent,this),this.app.on("uiButtonClicked",this.uiButtonClickedEvent,this),this.lightOn=!1},DaynightController.prototype.uiButtonClickedEvent=function(t){t===this.lightOnEntity.name&&(this.onSetDayEvent(!1),this.app.fire("taggingEvent","highBeamTurned",!0)),t===this.lightOffEntity.name&&(this.onSetDayEvent(!0),this.app.fire("taggingEvent","lightMenuCloseClicked"))},DaynightController.prototype.showOrHide=function(t){t?(this.lightOnEntity.enabled=!this.lightOn,this.lightOffEntity.enabled=this.lightOn):(this.lightOnEntity.enabled=!1,this.lightOffEntity.enabled=!1)},DaynightController.prototype.onSetDayEvent=function(t){this.lightOnEntity.enabled=t,this.lightOffEntity.enabled=!t,this.lightOn=!t,this.app.fire("lampOn",!t);for(var i=0;i<this.materials.length;i++){var e=this.materials[i].resources[0];e.emissiveIntensity=t?this.dayIntensities[i]:this.nightIntensities[i],i<this.dayTextures.length&&(e.emissiveMap=t?this.dayTextures[i].resources[0]:this.nightTextures[i].resources[0]),e.update()}null!=this.flareEntity&&(this.flareEntity.enabled=!t)},DaynightController.prototype.update=function(t){};var CustomShader=pc.createScript("customShader");CustomShader.prototype.initialize=function(){var t="\nvarying vec2 vUv0;\n\nuniform sampler2D uDiffuseMap;\nuniform int uFlip;\nvoid main(void)\n{\n    float x = 0.0;\n    if(uFlip > 0) {\n        x = 1.0 - vUv0.x;\n    } else {\n        x = vUv0.x;\n    }\n    vec2 uv = vec2(x, vUv0.y);\n    vec4 color = texture2D(uDiffuseMap, uv);\n    gl_FragColor = color;    \n}",e=this.app.graphicsDevice;t="precision "+e.precision+" float;\n"+t;var i={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:"\nattribute vec3 aPosition;\nattribute vec2 aUv0;\n\nuniform mat4 matrix_model;\nuniform mat4 matrix_viewProjection;\n\nvarying vec2 vUv0;\n\nvoid main(void)\n{\n    vUv0 = aUv0;\n    gl_Position = matrix_viewProjection * matrix_model * vec4(aPosition, 1.0);\n}",fshader:t};this.shader=new pc.Shader(e,i),this.material=new pc.Material,this.material.depthWrite=!1,this.material.blendType=pc.BLEND_NORMAL,null!=this.entity.element&&this.material.setParameter("uDiffuseMap",this.entity.element._image._texture),this.material.shader=this.shader,this.material.update(),null!=this.entity.model&&(this.entity.model.model.meshInstances[0].material=this.material),null!=this.entity.element&&(this.entity.element.material=this.material)},CustomShader.prototype.update=function(t){var e=(this.app.root.findByName("Camera").script.orbitCamera.yaw%360+360)%360,i="start"===this.entity.name&&e>180?1:0;this.material.setParameter("uFlip",i),this.material.update()};var InteriorMap=pc.createScript("interiorMap");InteriorMap.attributes.add("interiorTexture",{type:"asset",assetType:"texture",title:"interior texture"}),InteriorMap.prototype.initialize=function(){this.entity.model.model.meshInstances[0].material.emissiveMap=this.interiorTexture.resource,this.entity.model.model.meshInstances[0].material.update()},InteriorMap.prototype.update=function(e){};var Gyroscope=pc.createScript("gyroscope");Gyroscope.prototype.initialize=function(){if(window.DeviceOrientationEvent){var o=this;window.parent.addEventListener("deviceorientation",(function(t){o.onOrientationEvent(t)}))}this.app.on("gyroscope",this.onGyroscopeEvent,this)},Gyroscope.prototype.onGyroscopeEvent=function(o){this.entity.script.lookCamera.gyroscope=o},Gyroscope.prototype.onOrientationEvent=function(o){null!=o.alpha&&(this.entity.script.lookCamera.orientation=o)},Gyroscope.prototype.update=function(o){};var SetLayer=pc.createScript("setLayer");SetLayer.attributes.add("layer",{type:"number",default:15}),SetLayer.prototype.initialize=function(){if(this.entity.model&&this.entity.model.model)for(var e=this.entity.model.model.meshInstances,t=0;t<e.length;t++)e[t].layer=this.layer},SetLayer.prototype.update=function(e){};var Screenshot=pc.createScript("screenshot");Screenshot.attributes.add("cameraEntity",{type:"entity",description:"The camera entity to use for taking the screenshot with. Whatever, this camera renders will be in the screen capture."}),Screenshot.prototype.initialize=function(){this.createNewRenderTexture(),this.app.graphicsDevice.on("resizecanvas",(function(e,t){this.secsSinceSameSize=0}),this);var e=this.app.graphicsDevice;this.lastWidth=e.width,this.lastHeight=e.height,this.secsSinceSameSize=0,this.triggerScreenshot=!1;var onTakeScreenshot=function(){this.triggerScreenshot=!0,this.cameraEntity.enabled=!0};this.app.on("takeScreenshot",onTakeScreenshot,this),this.app.on("postrender",this.postRender,this),this.cameraEntity.enabled=!1,this.cameraEntity.camera.priority=-1;var t=document.createElement("a");t.id="link",window.document.body.appendChild(t),this.on("destroy",(function(){this.app.off("takeScreenshot",onTakeScreenshot,this),this.app.off("postrender",this.postRender,this),window.document.body.removeChild(t),this.renderTarget&&(this.renderTarget.destroy(),this.renderTarget=null),this.colorTexture&&(this.colorTexture.destroy(),this.colorTexture=null),this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null),this.canvas=null,this.context=null}),this)},Screenshot.prototype.update=function(e){var t=this.app.graphicsDevice;t.width==this.lastWidth&&t.height==this.lastHeight&&(this.secsSinceSameSize+=e),this.secsSinceSameSize>.25&&(this.unScaledTextureWidth==t.width&&this.unScaledTextureHeight==t.height||this.createNewRenderTexture()),this.lastWidth=t.width,this.lastHeight=t.height},Screenshot.prototype.postRender=function(){this.triggerScreenshot&&(this.takeScreenshot("screenshot"),this.triggerScreenshot=!1,this.cameraEntity.enabled=!1)},Screenshot.prototype.createNewRenderTexture=function(){var e=this.app.graphicsDevice;if(this.colorTexture&&this.depthTexture&&this.renderTarget){var t=this.renderTarget,i=this.colorTexture,r=this.depthTexture;this.renderTarget=null,this.colorTexture=null,this.depthTexture=null,t.destroy(),i.destroy(),r.destroy()}var h=new pc.Texture(e,{width:e.width,height:e.height,format:pc.PIXELFORMAT_R8_G8_B8_A8,autoMipmap:!0}),s=new pc.Texture(e,{format:pc.PIXELFORMAT_DEPTHSTENCIL,width:e.width,height:e.height,mipmaps:!1,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE});h.minFilter=pc.FILTER_LINEAR,h.magFilter=pc.FILTER_LINEAR;var a=new pc.RenderTarget({colorBuffer:h,depthBuffer:s,samples:4});this.cameraEntity.camera.renderTarget=a,this.unScaledTextureWidth=e.width,this.unScaledTextureHeight=e.height,this.colorTexture=h,this.depthTexture=s,this.renderTarget=a;var n=this.renderTarget.colorBuffer;this.canvas||(this.canvas=window.document.createElement("canvas"),this.context=this.canvas.getContext("2d")),this.canvas.width=n.width,this.canvas.height=n.height,this.context.globalCompositeOperation="copy",this.context.setTransform(1,0,0,1,0,0),this.context.scale(1,-1),this.context.translate(0,-this.canvas.height),this.pixels=new Uint8Array(h.width*h.height*4)},Screenshot.prototype.takeScreenshot=function(e){var t=this.renderTarget.colorBuffer,i=this.renderTarget.depthBuffer;this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,t.width,t.height),this.context.restore();var r=this.app.graphicsDevice.gl,h=this.app.graphicsDevice.gl.createFramebuffer(),s=this.pixels,a=t.impl?t.impl._glTexture:t._glTexture,n=i.impl?i.impl._glTexture:i._glTexture;r.bindFramebuffer(r.FRAMEBUFFER,h),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,n,0),r.readPixels(0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(h);this.context.createImageData(t.width,t.height).data;var c=this.context.getImageData(0,0,t.width,t.height);c.data.set(new Uint8ClampedArray(s)),this.context.putImageData(c,0,0),this.context.drawImage(this.canvas,0,0);var o=this.canvas.toDataURL("image/png");this.app.fire("screenshotTaken",o)};var ChangeHorizontalFov=pc.createScript("changeHorizontalFov");ChangeHorizontalFov.prototype.initialize=function(){var i=this,onResize=function(a,t){i.entity.camera.horizontalFov=t>a};this.app.graphicsDevice.on("resizecanvas",onResize,this),this.on("destroy",(function(){this.app.graphicsDevice.off("resizecanvas",onResize,this)})),onResize(this.app.graphicsDevice.width,this.app.graphicsDevice.height)};var SpotButtonV2=pc.createScript("spotButtonV2");SpotButtonV2.attributes.add("isInterior",{type:"boolean",default:!1,title:"interior mode",description:"flag if current mode is interior"}),SpotButtonV2.attributes.add("alpha",{type:"number",default:0}),SpotButtonV2.attributes.add("beta",{type:"number",default:0}),SpotButtonV2.prototype.initialize=function(){this.entity.element.on("mouseenter",this.onMouseEnter,this),this.entity.element.on("mouseleave",this.onMouseLeave,this),this.app.touch?this.entity.element.on(pc.EVENT_TOUCHEND,this.onMouseClicked,this):this.entity.element.on(pc.EVENT_MOUSEUP,this.onMouseClicked,this),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.on("spotIndex",this.onSpotIndexEvent,this),this.currentSpot=-1,this.isInterior||(this.uiController=this.app.root.findByName("spot buttons").script.uiController),this.camera=this.app.root.findByName("Camera")},SpotButtonV2.prototype.onSpotIndexEvent=function(t){this.currentSpot=t},SpotButtonV2.prototype.onMouseEnter=function(t){this.app.fire("mouseOverSpot",!0)},SpotButtonV2.prototype.onMouseLeave=function(t){this.app.fire("mouseOverSpot",!1)},SpotButtonV2.prototype.onMouseClicked=function(t){if(!this.isInterior){let t=this.camera.script.orbitCamera.yaw*Math.PI/180,e=Math.cos(t),i=Math.sin(t),o=this.entity.getPosition();o.z,o.x}parseInt(this.entity.name)>0?this.app.fire("spotButtonClicked",this.entity.name):(this.app.fire("uiButtonClicked",this.entity.name),this.entity.name.startsWith("go_")&&this.app.fire(this.isInterior?"goExteriorClicked":"goInteriorClicked"))},SpotButtonV2.prototype.setPosition=function(t,e,i){var o=t*Math.PI/180,a=e*Math.PI/180,s=3.5*Math.sin(a)*Math.sin(o),n=3.5*Math.cos(a),p=3.5*Math.sin(a)*Math.cos(o);this.isInterior&&(!i||i&&this.entity.name==this.currentSpot)&&this.entity.setPosition(s,n,p)},SpotButtonV2.prototype.onKeyDown=function(t){switch(t.key){case pc.KEY_W:this.beta-=1;break;case pc.KEY_A:this.alpha+=1;break;case pc.KEY_S:this.beta+=1;break;case pc.KEY_D:this.alpha-=1;break;case pc.KEY_UP:this.beta-=.1;break;case pc.KEY_LEFT:this.alpha+=.1;break;case pc.KEY_DOWN:this.beta+=.1;break;case pc.KEY_RIGHT:this.alpha-=.1}this.setPosition(this.alpha,this.beta,!0)},SpotButtonV2.prototype.update=function(t){var e=this.camera.getPosition();if(this.setPosition(this.alpha,this.beta,!1),parseInt(this.entity.name)>0)if(this.isInterior){let t=this.camera.forward,e=(new pc.Vec3).copy(t),i=(new pc.Vec3).copy(pc.Vec3.UP),o=(new pc.Vec3).cross(i,e);i.cross(e,o);let a=new pc.Mat4;a.data[0]=o.x,a.data[1]=o.y,a.data[2]=o.z,a.data[4]=i.x,a.data[5]=i.y,a.data[6]=i.z,a.data[8]=e.x,a.data[9]=e.y,a.data[10]=e.z;let s=new pc.Quat;s.setFromMat4(a),this.entity.setRotation(s),this.entity.rotateLocal(0,180,0)}else this.entity.lookAt(e),this.entity.rotateLocal(0,180,0);else if(this.isInterior)this.entity.lookAt(e),this.entity.rotateLocal(0,180,0);else{let t=this.entity.getPosition(),i=new pc.Vec3;i.copy(e),i.sub(t),i.normalize();let o=(new pc.Vec3).copy(i).scale(-1),a=this.camera.getWorldTransform(),s=new pc.Vec3;s.x=a.data[4],s.y=a.data[5],s.z=a.data[6];let n=(new pc.Vec3).cross(s,o);s.cross(o,n);let p=new pc.Mat4;p.data[0]=n.x,p.data[1]=n.y,p.data[2]=n.z,p.data[4]=s.x,p.data[5]=s.y,p.data[6]=s.z,p.data[8]=o.x,p.data[9]=o.y,p.data[10]=o.z;let r=new pc.Quat;r.setFromMat4(p),this.entity.setRotation(r),this.entity.rotateLocal(0,180,0)}},SpotButtonV2.prototype.swap=function(t){};var SpotAnimate=pc.createScript("spotAnimate");SpotAnimate.attributes.add("vs",{type:"asset",assetType:"shader",title:"vertex shader"}),SpotAnimate.attributes.add("fs",{type:"asset",assetType:"shader",title:"fragment shader"}),SpotAnimate.prototype.initialize=function(){var t=this.app.graphicsDevice,e="precision "+t.precision+" float;\n"+this.fs.resource,s={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:this.vs.resource,fshader:e};this.shader=new pc.Shader(t,s),this.material=new pc.Material,this.material.shader=this.shader,this.material.cull=pc.CULLFACE_NONE,this.material.blendType=pc.BLEND_NORMAL,this.material.alphaTest=.1,this.progress=0,this.time=2,this.opacity=1,this.material.setParameter("uProgress",this.progress),this.material.setParameter("uOpacity",this.opacity),this.material.update(),this.entity.element.material=this.material,this.isActive=!0},SpotAnimate.prototype.setClicked=function(){this.opacity=.2,this.material.setParameter("uOpacity",this.opacity)},SpotAnimate.prototype.update=function(t){this.progress+=t/this.time,this.progress>1&&(this.progress=0),this.material.setParameter("uProgress",this.progress)};var UiController=pc.createScript("uiController");UiController.attributes.add("openDoorButton",{type:"entity"}),UiController.attributes.add("closeDoorButton",{type:"entity"}),UiController.attributes.add("sideMirrorButton",{type:"entity"}),UiController.attributes.add("animateWheelButton",{type:"entity"}),UiController.attributes.add("spots",{type:"entity",array:!0}),UiController.attributes.add("model",{type:"entity"}),UiController.prototype.initialize=function(){this.doorOpenAnimName="dooropen.json",this.doorCloseAnimName="doorclose.json",this.sideMirrorAnimName="sidemirror.json",this.animateWheelAnimName="animatewheel.json",this.STATE_INIT=0,this.STATE_PROGRESS=1,this.STATE_OPEN=2,this.doorOpenState=this.STATE_INIT,this.sideMirrorState=this.STATE_INIT,this.wheelState=this.STATE_INIT,this.isOpenDoorButton=!0,this.app.on("uiButtonClicked",this.uiButtonClickedEvent,this),this.app.on("spotButtonClicked",this.spotButtonClickedEvent,this),this.app.on("spotButtonSelected",this.spotButtonSelectedEvent,this),this.app.on("showOrHideAllSpots",this.showOrHideAllSpots,this),this.app.on("showOrHideUISpots",this.showOrHideUISpots,this),this.on("destroy",(function(){this.app.off("uiButtonClicked",this.uiButtonClickedEvent,this),this.app.off("spotButtonClicked",this.spotButtonClickedEvent,this),this.app.off("spotButtonSelected",this.spotButtonSelectedEvent,this),this.app.off("showOrHideAllSpots",this.showOrHideAllSpots,this),this.app.off("showOrHideUISpots",this.showOrHideUISpots,this)}),this),this.daynightController=this.app.root.findByName("daynight controller")},UiController.prototype.showOrHideAllSpots=function(t){for(var o of this.spots)o.enabled=t;this.showOrHideUISpots(t)},UiController.prototype.showOrHideUISpots=function(t){this.sideMirrorButton.enabled=t,this.animateWheelButton.enabled=t,t?this.isOpenDoorButton?this.openDoorButton.enabled=!0:this.closeDoorButton.enabled=!0:(this.openDoorButton.enabled=!1,this.closeDoorButton.enabled=!1),null!=this.entity.script.multiButtons?this.entity.script.multiButtons.showOrHide(t):this.daynightController.script.daynightController.showOrHide(t),this.entity.script.goInteriorControllerV2.showOrHide(t)},UiController.prototype.spotButtonClickedEvent=function(t){for(var o of this.spots)o.name===t&&o.script.spotAnimate.setClicked()},UiController.prototype.spotButtonSelectedEvent=function(t){if(""==t)for(var o of(this.showOrHideAllSpots(!0),this.spots))o.script.spotAnimate.showByState(!1);else for(var o of(this.showOrHideAllSpots(!1),this.spots))o.name===t&&(o.enabled=!0,o.script.spotAnimate.showByState(!0))},UiController.prototype.uiButtonClickedEvent=function(t){t===this.openDoorButton.name&&(this.openDoor(),this.app.fire("taggingEvent","doorOpenButtonClicked")),t===this.closeDoorButton.name&&(this.closeDoor(),this.app.fire("taggingEvent","doorCloseButtonClicked")),t===this.sideMirrorButton.name&&(this.sideMirror(),this.app.fire("taggingEvent","sideMirrorMoveButtonClicked")),t===this.animateWheelButton.name&&(this.animateWheel(),this.app.fire("taggingEvent","wheelMoveButtonClicked"))},UiController.prototype.openDoor=function(){if(this.doorOpenState==this.STATE_INIT){this.doorOpenState=this.STATE_PROGRESS,this.openDoorButton.enabled=!1,this.closeDoorButton.enabled=!0,this.isOpenDoorButton=!1,this.model.animation.speed=1,this.model.animation.play(this.doorOpenAnimName,0);var t=this.model.animation.animations[this.doorOpenAnimName].duration;setTimeout(function(){this.doorOpenState=this.STATE_OPEN}.bind(this),1e3*t)}},UiController.prototype.closeDoor=function(){if(this.doorOpenState==this.STATE_OPEN){this.doorOpenState=this.STATE_PROGRESS,this.openDoorButton.enabled=!0,this.closeDoorButton.enabled=!1,this.isOpenDoorButton=!0;var t=this.model.animation.animations[this.doorOpenAnimName].duration;this.model.animation.play(this.doorCloseAnimName,0),setTimeout(function(){this.doorOpenState=this.STATE_INIT}.bind(this),1e3*t)}},UiController.prototype.sideMirror=function(){if(this.sideMirrorState==this.STATE_INIT){this.sideMirrorState=this.STATE_PROGRESS,this.model.animation.speed=1,this.model.animation.play(this.sideMirrorAnimName,0);var t=this.model.animation.animations[this.sideMirrorAnimName].duration;setTimeout(function(){this.sideMirrorState=this.STATE_INIT}.bind(this),1e3*t)}},UiController.prototype.animateWheel=function(){if(this.wheelState==this.STATE_INIT){this.wheelState=this.STATE_PROGRESS,this.model.animation.speed=1,this.model.animation.play(this.animateWheelAnimName,0);var t=this.model.animation.animations[this.animateWheelAnimName].duration;setTimeout(function(){this.wheelState=this.STATE_INIT}.bind(this),1e3*t)}},UiController.prototype.update=function(t){};var GoInteriorControllerV2=pc.createScript("goInteriorControllerV2");GoInteriorControllerV2.prototype.initialize=function(){this.app.on("uiButtonClicked",this.uiButtonClickedEvent,this),this.startEntity=this.entity.findByName("start"),this.closeEntity=this.entity.findByName("close"),this.goRightEntity=this.entity.findByName("go_right"),this.goLeftEntity=this.entity.findByName("go_left"),this.closeEntity.enabled=!1,this.goRightEntity.enabled=!1,this.goLeftEntity.enabled=!1,this._closeShown=!1,this.showAllSpots=!0},GoInteriorControllerV2.prototype.uiButtonClickedEvent=function(t){"start"===t&&(this._closeShown=!0,this.closeEntity.enabled=!0,this.startEntity.enabled=!1),"close"===t&&(this._closeShown=!1,this.closeEntity.enabled=!1,this.startEntity.enabled=!0)},GoInteriorControllerV2.prototype.showOrHide=function(t){this.showAllSpots=t,t?this._closeShown?this.closeEntity.enabled=!0:this.startEntity.enabled=!0:(this.startEntity.enabled=!1,this.closeEntity.enabled=!1,this.goRightEntity.enabled=!1,this.goLeftEntity.enabled=!1)},GoInteriorControllerV2.prototype.update=function(t){var i=(this.app.root.findByName("Camera").script.orbitCamera.yaw%360+360)%360,e=i*Math.PI/180,n=.437,o=this.startEntity.getPosition();if(this.showAllSpots&&this._closeShown)if(i<180){this.goRightEntity.enabled=!0,this.goLeftEntity.enabled=!1;let t=o.x+Math.cos(e)*n,i=o.z-Math.sin(e)*n,s=new pc.Vec3(t,o.y,i);this.goRightEntity.setPosition(s)}else{this.goRightEntity.enabled=!1,this.goLeftEntity.enabled=!0;let t=o.x-Math.cos(e)*n,i=o.z+Math.sin(e)*n,s=new pc.Vec3(t,o.y,i);this.goLeftEntity.setPosition(s)}else this.goRightEntity.enabled=!1,this.goLeftEntity.enabled=!1};var GoExteriorController=pc.createScript("goExteriorController");GoExteriorController.attributes.add("spots",{type:"entity",array:!0}),GoExteriorController.prototype.initialize=function(){this.app.on("uiButtonClicked",this.uiButtonClickedEvent,this),this.app.on("spotButtonClicked",this.spotButtonClickedEvent,this),this.app.on("spotButtonSelected",this.spotButtonSelectedEvent,this),this.app.on("showOrHideAllSpots",this.showOrHideAllSpots,this),this.on("destroy",(function(){this.app.off("uiButtonClicked",this.uiButtonClickedEvent,this),this.app.off("spotButtonClicked",this.spotButtonClickedEvent,this),this.app.off("spotButtonSelected",this.spotButtonSelectedEvent,this),this.app.off("showOrHideAllSpots",this.showOrHideAllSpots,this)}),this),this.startEntity=this.entity.findByName("start"),this.closeEntity=this.entity.findByName("close"),this.goExteriorEntity=this.entity.findByName("go_exterior"),this.showAllSpots=!0,this._closeShown=!1},GoExteriorController.prototype.uiButtonClickedEvent=function(t){"start"===t&&(this._closeShown=!0,this.closeEntity.enabled=!0,this.startEntity.enabled=!1,this.goExteriorEntity.enabled=!0),"close"===t&&(this._closeShown=!1,this.closeEntity.enabled=!1,this.startEntity.enabled=!0,this.goExteriorEntity.enabled=!1)},GoExteriorController.prototype.showOrHideAllSpots=function(t){for(var o of(this.showAllSpots=t,t?this._closeShown?(this.closeEntity.enabled=!0,this.goExteriorEntity.enabled=!0):this.startEntity.enabled=!0:(this.startEntity.enabled=!1,this.closeEntity.enabled=!1,this.goExteriorEntity.enabled=!1),this.spots))o.enabled=t},GoExteriorController.prototype.spotButtonClickedEvent=function(t){for(var o of this.spots)o.name===t&&o.script.spotAnimate.setClicked()},GoExteriorController.prototype.spotButtonSelectedEvent=function(t){if(""==t)for(var o of(this.showOrHideAllSpots(!0),this.spots))o.script.spotAnimate.showByState(!1);else for(var o of(this.showOrHideAllSpots(!1),this.spots))o.name===t&&(o.enabled=!0,o.script.spotAnimate.showByState(!0))},GoExteriorController.prototype.update=function(t){};var MultiButtons=pc.createScript("multiButtons");MultiButtons.attributes.add("startEntity",{type:"entity"}),MultiButtons.attributes.add("closeEntity",{type:"entity"}),MultiButtons.attributes.add("buttonEntities",{type:"entity",array:!0}),MultiButtons.attributes.add("onTextures",{type:"asset",assetType:"texture",array:!0}),MultiButtons.attributes.add("offTextures",{type:"asset",assetType:"texture",array:!0}),MultiButtons.attributes.add("angles",{type:"number",array:!0}),MultiButtons.attributes.add("radius",{type:"number"}),MultiButtons.prototype.initialize=function(){for(var t of(this.app.on("uiButtonClicked",this.uiButtonClickedEvent,this),this.on("destroy",(function(){this.app.off("uiButtonClicked",this.uiButtonClickedEvent,this)}),this),this.closeEntity.enabled=!1,this._closeShown=!1,this.buttonEntities))t.enabled=!1;this.lightMode=-1,this.turnMode=!1,this.orbitCamera=this.app.root.findByName("Camera").script.orbitCamera},MultiButtons.prototype.uiButtonClickedEvent=function(t){var e;if(t===this.startEntity.name){for(e of(this._closeShown=!0,this.closeEntity.enabled=!0,this.startEntity.enabled=!1,this.buttonEntities))e.enabled=!0;this.app.fire("taggingEvent","lightMenuOpenClicked")}if(t===this.closeEntity.name){for(e of(this._closeShown=!1,this.closeEntity.enabled=!1,this.startEntity.enabled=!0,this.buttonEntities))e.enabled=!1;this.app.fire("taggingEvent","lightMenuCloseClicked")}for(var i=-1,s=0;s<this.buttonEntities.length;s++)t==this.buttonEntities[s].name&&(i=s);var n=t==this.closeEntity.name;if(1==i){var o=this.turnMode;this.buttonEntities[i].element.texture=o?this.offTextures[i].resource:this.onTextures[i].resource,this.turnMode=!o,this.app.fire("lampChanged",this.lightMode,this.turnMode),this.app.fire("taggingEvent","turnSignalTurned",this.turnMode)}else n?(this.lightMode>=0&&(this.buttonEntities[this.lightMode].element.texture=this.offTextures[this.lightMode].resource),this.buttonEntities[0].element.texture=this.offTextures[0].resource,this.buttonEntities[1].element.texture=this.offTextures[1].resource,this.lightMode=-1,this.turnMode=!1,this.app.fire("lampChanged",this.lightMode,this.turnMode)):i>=0&&(i!=this.lightMode?0==i?-1==this.lightMode&&(this.buttonEntities[i].element.texture=this.onTextures[i].resource,this.lightMode=i,this.app.fire("lampChanged",i,this.turnMode),this.app.fire("taggingEvent","taillightTurned",!0)):2!=i&&3!=i||(this.lightMode>=0&&(this.buttonEntities[this.lightMode].element.texture=this.offTextures[this.lightMode].resource),this.buttonEntities[0].element.texture=this.onTextures[0].resource,this.buttonEntities[i].element.texture=this.onTextures[i].resource,this.lightMode=i,this.app.fire("lampChanged",i,this.turnMode),this.app.fire("taggingEvent",2==i?"lowBeamTurned":"highBeamTurned",!0)):i>=0&&(this.buttonEntities[0].element.texture=this.offTextures[0].resource,this.buttonEntities[i].element.texture=this.offTextures[i].resource,0!=i&&2!=i&&3!=i||this.app.fire("taggingEvent",0==i?"taillightTurned":2==i?"lowBeamTurned":"highBeamTurned",!1),this.lightMode=-1,this.app.fire("lampChanged",-1,this.turnMode)))},MultiButtons.prototype.showOrHide=function(t){var e;if(t)if(this._closeShown)for(e of(this.closeEntity.enabled=!0,this.buttonEntities))e.enabled=!0;else this.startEntity.enabled=!0;else for(e of(this.closeEntity.enabled=!1,this.startEntity.enabled=!1,this.buttonEntities))e.enabled=!1},MultiButtons.prototype.rotate=function(t,e,i){var s=1-Math.cos(i),n=Math.sin(i),o=t.x,h=t.y,r=t.z,a=[1-(r*r+h*h)*s,-r*n+o*h*s,h*n+o*r*s,r*n+o*h*s,1-(r*r+o*o)*s,-o*n+h*r*s,-h*n+o*r*s,o*n+h*r*s,1-(o*o+h*h)*s];return o=a[0]*e.x+a[1]*e.y+a[2]*e.z,h=a[3]*e.x+a[4]*e.y+a[5]*e.z,r=a[6]*e.x+a[7]*e.y+a[8]*e.z,new pc.Vec3(o,h,r)},MultiButtons.prototype.update=function(t){var e,i=(this.orbitCamera.yaw%360+360)%360,s=i*Math.PI/180,n=(this.orbitCamera.pitch,Math.PI,this.startEntity.getPosition()),o=this.app.root.findByName("Camera");if(this._closeShown)if(i>180)for(e in this.buttonEntities){let t=this.angles[e]*Math.PI/180;axis=o.forward;let i=new pc.Vec3(Math.cos(s),0,Math.sin(-s)),h=this.rotate(axis,i,t),r=n.x+h.x*this.radius,a=n.y+h.y*this.radius,u=n.z+h.z*this.radius,l=new pc.Vec3(r,a,u);this.buttonEntities[e].setPosition(l)}else for(e in this.buttonEntities){let t=-this.angles[e]*Math.PI/180;axis=o.forward;let i=new pc.Vec3(-Math.cos(s),0,Math.sin(s)),h=this.rotate(axis,i,t),r=n.x+h.x*this.radius,a=n.y+h.y*this.radius,u=n.z+h.z*this.radius,l=new pc.Vec3(r,a,u);this.buttonEntities[e].setPosition(l)}};var LampController=pc.createScript("lampController");LampController.attributes.add("vs",{type:"asset",assetType:"shader"}),LampController.attributes.add("fs",{type:"asset",assetType:"shader"}),LampController.attributes.add("models",{type:"entity",array:!0}),LampController.attributes.add("flareEntity",{type:"entity",title:"flare entity"}),LampController.attributes.add("flareSubEntity",{type:"entity",title:"flare sub entity"}),LampController.attributes.add("flareTurnEntity",{type:"entity"}),LampController.attributes.add("turnMaterials",{type:"asset",assetType:"material",array:!0,title:"turn materials"}),LampController.attributes.add("turnTextures",{type:"asset",assetType:"texture",array:!0,title:"turn textures"}),LampController.attributes.add("turnOffTextures",{type:"asset",assetType:"texture",array:!0,title:"turn off textures"}),LampController.attributes.add("turnOnTextures",{type:"asset",assetType:"texture",array:!0,title:"turn on textures"}),LampController.attributes.add("materials",{type:"asset",assetType:"material",array:!0,title:"materials"}),LampController.attributes.add("dayIntensities",{type:"number",array:!0,title:"day intensities"}),LampController.attributes.add("nightIntensities",{type:"number",array:!0,title:"night intensities"}),LampController.attributes.add("dayTextures",{type:"asset",assetType:"texture",array:!0,title:"day textures"}),LampController.attributes.add("nightTextures",{type:"asset",assetType:"texture",array:!0,title:"night textures"}),LampController.prototype.initialize=function(){var t,e=this.app.graphicsDevice,r="precision "+e.precision+" float;\n"+this.fs.resource,s={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:this.vs.resource,fshader:r};this.shader=new pc.Shader(e,s),this.turnMaterialsCustom=[];for(var a=0;a<this.turnMaterials.length;a++)t=this.createMaterial(this.shader,this.turnOffTextures[a].resources[0],this.turnTextures[a].resources[0],this.turnOnTextures[a]?.resources[0]),this.setMaterial(this.turnMaterials[a],t),this.turnMaterialsCustom.push(t);this.progress=0,this.isTurnMode=!1,this.app.on("uiButtonClicked",this.uiButtonClickedEvent,this),this.app.on("lampChanged",this.lampChangedEvent,this),this.on("destroy",(function(){this.app.off("uiButtonClicked",this.uiButtonClickedEvent,this),this.app.off("lampChanged",this.lampChangedEvent,this)}),this)},LampController.prototype.createMaterial=function(t,e,r,s){var a=new pc.Material;return a.shader=t,a.cull=pc.CULLFACE_NONE,a.blendType=pc.BLEND_NORMAL,a.setParameter("uProgress",0),a.setParameter("uMode",0),a.setParameter("uOff",e),a.setParameter("uTurn",r||e),a.setParameter("uOn",s||e),a.update(),a},LampController.prototype.setMaterial=function(t,e){var r=t.name;for(var s of this.models)for(var a of s.model.meshInstances)a.material.name==r&&(a.material=e)},LampController.prototype.textureLight=function(t){for(var e=0;e<this.materials.length;e++){var r=this.materials[e].resources[0];r.emissiveIntensity=t?this.nightIntensities[e]:this.dayIntensities[e],e<this.dayTextures.length&&(r.emissiveMap=t?this.nightTextures[e].resources[0]:this.dayTextures[e].resources[0]),r.update()}this.app.fire("lampOn",t)},LampController.prototype.lampChangedEvent=function(t,e){if(0===t?(this.flareEntity.enabled=!1,this.flareSubEntity&&(this.flareSubEntity.enabled=!0),this.textureLight(!0)):2===t?(this.flareEntity.enabled=!0,this.flareEntity.script.flareFilterV2.setLowMode(!0),this.flareSubEntity&&(this.flareSubEntity.enabled=!0),this.textureLight(!0)):3===t?(this.flareEntity.enabled=!0,this.flareEntity.script.flareFilterV2.setLowMode(!1),this.flareSubEntity&&(this.flareSubEntity.enabled=!0),this.textureLight(!0)):-1===t&&(this.flareEntity.enabled=!1,this.flareSubEntity&&(this.flareSubEntity.enabled=!1),this.textureLight(!1)),this.isActive=e,this.isTurnMode=e,e)this.setParameters("uMode",1);else if(t>=0){this.setParameters("uMode",0);for(var r=0;r<this.turnMaterialsCustom.length;r++)null!=this.turnOnTextures[r]&&this.turnMaterialsCustom[r].setParameter("uMode",3)}else this.setParameters("uMode",0)},LampController.prototype.setParameters=function(t,e){for(var r=0;r<this.turnMaterialsCustom.length;r++)this.turnMaterialsCustom[r].setParameter(t,e)},LampController.prototype.uiButtonClickedEvent=function(t){"light_close"===t&&this.lampChangedEvent(-1)},LampController.prototype.getProgress=function(){for(var t=this.progress;t>=2;)t-=2;return t<=1?t:2-t},LampController.prototype.update=function(t){if(this.isActive){var e=this.progress+3*t;e>=2&&(e-=2),this.progress=e;var r=e<=1?e:2-e;this.setParameters("uProgress",r)}};var FlareFilterV2=pc.createScript("flareFilterV2");FlareFilterV2.attributes.add("vs",{type:"asset",assetType:"shader"}),FlareFilterV2.attributes.add("fs",{type:"asset",assetType:"shader"}),FlareFilterV2.prototype.initialize=function(){var e=pc.app.graphicsDevice;fragmentShader="precision "+e.precision+" float;\n"+this.fs.resource;var t={attributes:{aPosition:pc.SEMANTIC_POSITION,aNormal:pc.SEMANTIC_NORMAL,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:this.vs.resource,fshader:fragmentShader};this.materials=[];let a=this.entity.model.meshInstances.length;this.isLow=!1;for(let i=0;i<a;i++){var s=this.entity.model.meshInstances[i].material,r=this.materials.filter((e=>e.name===s.name));let a,l=s.emissiveMap;if(0===r.length){a=new pc.Material;let r=new pc.Shader(e,t);a.blendType=pc.BLEND_ADDITIVE,a.shader=r,a.depthWrite=!1,a.depthTest=!1,a.update(),a.setParameter("uDiffuseMap",l);let i=s.emissive;a.name=s.name,a.setParameter("uEmissive",[i.r,i.g,i.b]),this.materials.push(a)}else a=r[0];this.entity.model.meshInstances[i].material=a}},FlareFilterV2.prototype.setLowMode=function(e){if(this.isLow=e,null!=this.materials)for(let t of this.materials)"lensflare2"===t.name&&(e?t.setParameter("uEmissive",[.1,.1,.1]):t.setParameter("uEmissive",[1,1,1]))},FlareFilterV2.prototype.update=function(e){var t=pc.app.root.findByName("Camera").forward;for(let e of this.materials)e.setParameter("uViewVec",[-t.x,-t.y,-t.z])};var SpotProgress=pc.createScript("spotProgress");SpotProgress.attributes.add("vs",{type:"asset",assetType:"shader",title:"vertex shader"}),SpotProgress.attributes.add("fs",{type:"asset",assetType:"shader",title:"fragment shader"}),SpotProgress.attributes.add("playTexture",{type:"asset",assetType:"texture"}),SpotProgress.attributes.add("pauseTexture",{type:"asset",assetType:"texture"}),SpotProgress.attributes.add("fillTexture",{type:"asset",assetType:"texture"}),SpotProgress.attributes.add("time",{type:"number",default:2}),SpotProgress.prototype.initialize=function(){var t=this.app.graphicsDevice,e="precision "+t.precision+" float;\n"+this.fs.resource,s={attributes:{aPosition:pc.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:this.vs.resource,fshader:e};this.shader=new pc.Shader(t,s),this.material=new pc.Material,this.material.shader=this.shader,this.material.blendType=pc.BLEND_NORMAL,this.progress=0,this.material.setParameter("uProgress",this.progress),this.material.setParameter("uPlay",this.playTexture.resource),this.material.setParameter("uPause",this.pauseTexture.resource),this.material.setParameter("uFill",this.fillTexture.resource),this.material.update(),this.entity.element.material=this.material,this.entity.element.on("mousedown",this.entityClicked,this),this.entity.element.on("touchend",this.entityClicked,this),this.isActive=!1,this.app.on("uiButtonClicked",this.entityClicked,this)},SpotProgress.prototype.entityClicked=function(t){t===this.entity.name&&(this.isActive=!0)},SpotProgress.prototype.update=function(t){this.isActive&&(this.progress+=t/this.time,this.progress>1&&(this.progress=0,this.isActive=!1),this.material.setParameter("uProgress",this.progress))};